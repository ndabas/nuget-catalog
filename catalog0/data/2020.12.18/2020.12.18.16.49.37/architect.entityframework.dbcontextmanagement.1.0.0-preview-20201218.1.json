{
  "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json",
  "@type": [
    "PackageDetails",
    "catalog:Permalink"
  ],
  "authors": "TheArchitectDev, Timovzl",
  "catalog:commitId": "af3f4df0-d4d2-441b-b2b0-275682bb1048",
  "catalog:commitTimeStamp": "2020-12-18T16:49:37.5611691Z",
  "copyright": "The Architect",
  "created": "2020-12-18T16:02:47.41Z",
  "description": "Manage your DbContexts the right way.\n\nhttps://github.com/TheArchitectDev/Architect.EntityFramework.DbContextManagement\n\nThe persistence layer or infrastructure layer uses the DbContext (e.g. from a repository). Controlling its scope and transaction lifetime, however, is ideally the reponsibility of the orchestrating layer (e.g. from an application service). This package adds that ability to Entity Framework Core 5.0.0 and up.\n\n// Register\npublic void ConfigureServices(IServiceCollection services)\n{\n  services.AddPooledDbContextFactory<MyDbContext>(context =>\n    context.UseSqlServer(connectionString, sqlServer => sqlServer.EnableRetryOnFailure()));\n\n  services.AddDbContextScope<MyDbContext>();\n}\n\n// Consume\npublic class MyRepository : IMyRepository\n{\n  // Accesses the DbContext instance currently provided by the orchestrating layer\n  private MyDbContext DbContext => this.DbContextAccessor.CurrentDbContext;\n\n  private IDbContextAccessor<MyDbContext> DbContextAccessor { get; }\n\n  public OrderRepo(IDbContextAccessor<MyDbContext> dbContextAccessor)\n  {\n    this.DbContextAccessor = dbContextAccessor ?? throw new ArgumentNullException(nameof(dbContextAccessor));\n  }\n\n  public Task<Order> GetOrderById(long id)\n  {\n    return this.DbContext.Orders.SingleOrDefaultAsync(o.Id == id);\n  }\n}\n\n// Orchestrate\npublic class MyApplicationService\n{\n  private IDbContextProvider<MyDbContext> DbContextProvider { get; }\n  private IMyRepository MyRepository { get; }\n\n  public MyApplicationService(IDbContextProvider<MyDbContext> dbContextProvider, IMyRepository myRepository)\n  {\n    this.DbContextProvider = dbContextProvider ?? throw new ArgumentNullException(nameof(dbContextProvider));      \n    this.MyRepository = myRepository ?? throw new ArgumentNullException(nameof(myRepository));\n  }\n\n  public async Task PerformSomeUnitOfWork()\n  {\n    // Provide a DbContext and execute a block of code within its scope\n    await this.DbContextProvider.ExecuteInDbContextScopeAsync(async executionScope =>\n    {\n      // Until the end of this block, IDbContextAccessor can access the scoped DbContext\n      // It can do so from any number of invocations deep (not shown here)\n      await this.MyRepository.AddOrder(new Order());\n\n      // If we have made modifications, we should save them\n      // We could save here or as part of the repository methods, depending on our preference\n      await executionScope.DbContext.SaveChangesAsync();\n    }); // If no exceptions occurred and this scope was not nested in another, the transaction is committed asynchronously here\n  }\n}",
  "id": "Architect.EntityFramework.DbContextManagement",
  "isPrerelease": true,
  "lastEdited": "2020-12-18T16:49:20.247Z",
  "licenseFile": "LICENSE",
  "licenseUrl": "https://aka.ms/deprecateLicenseUrl",
  "listed": false,
  "packageHash": "ARwkgTUDRMzB7WpQ6FgAd99Cp+SldepTHTvhVc7cQEIT29mjDx6MSVDoe4Wsh3OfCBdeJB72kfExcrV8TWcRuA==",
  "packageHashAlgorithm": "SHA512",
  "packageSize": 62374,
  "published": "1900-01-01T00:00:00Z",
  "repository": "",
  "requireLicenseAcceptance": false,
  "verbatimVersion": "1.0.0-preview-20201218.1",
  "version": "1.0.0-preview-20201218.1",
  "dependencyGroups": [
    {
      "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#dependencygroup/.netcoreapp3.1",
      "@type": "PackageDependencyGroup",
      "dependencies": [
        {
          "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#dependencygroup/.netcoreapp3.1/architect.ambientcontexts",
          "@type": "PackageDependency",
          "id": "Architect.AmbientContexts",
          "range": "[1.0.0, )"
        },
        {
          "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#dependencygroup/.netcoreapp3.1/microsoft.entityframeworkcore",
          "@type": "PackageDependency",
          "id": "Microsoft.EntityFrameworkCore",
          "range": "[5.0.0, )"
        },
        {
          "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#dependencygroup/.netcoreapp3.1/microsoft.entityframeworkcore.relational",
          "@type": "PackageDependency",
          "id": "Microsoft.EntityFrameworkCore.Relational",
          "range": "[5.0.0, )"
        }
      ],
      "targetFramework": ".NETCoreApp3.1"
    }
  ],
  "packageEntries": [
    {
      "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#Architect.EntityFramework.DbContextManagement.nuspec",
      "@type": "PackageEntry",
      "compressedLength": 1559,
      "fullName": "Architect.EntityFramework.DbContextManagement.nuspec",
      "length": 3997,
      "name": "Architect.EntityFramework.DbContextManagement.nuspec"
    },
    {
      "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#lib/netcoreapp3.1/Architect.EntityFramework.DbContextManagement.dll",
      "@type": "PackageEntry",
      "compressedLength": 36424,
      "fullName": "lib/netcoreapp3.1/Architect.EntityFramework.DbContextManagement.dll",
      "length": 90112,
      "name": "Architect.EntityFramework.DbContextManagement.dll"
    },
    {
      "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#lib/netcoreapp3.1/Architect.EntityFramework.DbContextManagement.xml",
      "@type": "PackageEntry",
      "compressedLength": 8933,
      "fullName": "lib/netcoreapp3.1/Architect.EntityFramework.DbContextManagement.xml",
      "length": 112961,
      "name": "Architect.EntityFramework.DbContextManagement.xml"
    },
    {
      "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#LICENSE",
      "@type": "PackageEntry",
      "compressedLength": 2678,
      "fullName": "LICENSE",
      "length": 7817,
      "name": "LICENSE"
    },
    {
      "@id": "https://api.nuget.org/v3/catalog0/data/2020.12.18.16.49.37/architect.entityframework.dbcontextmanagement.1.0.0-preview-20201218.1.json#.signature.p7s",
      "@type": "PackageEntry",
      "compressedLength": 9471,
      "fullName": ".signature.p7s",
      "length": 9471,
      "name": ".signature.p7s"
    }
  ],
  "tags": [
    "DbContext",
    "DbContextScope",
    "AmbientDbContext",
    "EntityFramework",
    "Entity",
    "Framework",
    "EF",
    "Core",
    "EfCore",
    "AmbientContext",
    "AmbientScope",
    "ambient",
    "context",
    "scope",
    "IoC",
    "inversion",
    "control",
    "transaction",
    "UnitOfWork",
    "unit",
    "work"
  ],
  "@context": {
    "@vocab": "http://schema.nuget.org/schema#",
    "catalog": "http://schema.nuget.org/catalog#",
    "xsd": "http://www.w3.org/2001/XMLSchema#",
    "dependencies": {
      "@id": "dependency",
      "@container": "@set"
    },
    "dependencyGroups": {
      "@id": "dependencyGroup",
      "@container": "@set"
    },
    "packageEntries": {
      "@id": "packageEntry",
      "@container": "@set"
    },
    "packageTypes": {
      "@id": "packageType",
      "@container": "@set"
    },
    "supportedFrameworks": {
      "@id": "supportedFramework",
      "@container": "@set"
    },
    "tags": {
      "@id": "tag",
      "@container": "@set"
    },
    "vulnerabilities": {
      "@id": "vulnerability",
      "@container": "@set"
    },
    "published": {
      "@type": "xsd:dateTime"
    },
    "created": {
      "@type": "xsd:dateTime"
    },
    "lastEdited": {
      "@type": "xsd:dateTime"
    },
    "catalog:commitTimeStamp": {
      "@type": "xsd:dateTime"
    },
    "reasons": {
      "@container": "@set"
    }
  }
}